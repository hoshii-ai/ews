package ews

import (
	"fmt"
	"testing"
)

func Test_UpdateCategoriesRa(t *testing.T) {
	client := NewClient(url, username, password, &Config{
		Dump:    true,
		NTLM:    true,
		SkipTLS: false,
	})

	xmlData := `<m:UpdateItem MessageDisposition="SaveOnly">
  <m:ItemChanges>
    <t:ItemChange>
      <t:ItemId Id="AQMkADMxNGE3NDBlLWM5YTgtNDcxNC1hY2MAZS01ODYzNDI4MmMyZmIARgAAA86NEQy5nkxKki+7fYkNVPYHAO19TxRiuvhPgGCs3ZI1H30AAAIBDQAAAO19TxRiuvhPgGCs3ZI1H30AAAIR2AAAAA==" ChangeKey="CQAAABYAAADtfU8UYrr4T4BgrN2SNR99AAKYV21h"></t:ItemId>
      <t:Updates>
        <t:SetItemField>
          <t:ExtendedFieldURI PropertyTag="0x7c08" PropertyType="Binary"></t:ExtendedFieldURI>
          <t:Message>
            <t:ExtendedProperty>
			  <t:ExtendedFieldURI PropertyTag="0x7c08" PropertyType="Binary"></t:ExtendedFieldURI>
              <t:Value>PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPGNhdGVnb3JpZXMgeG1sbnM9IkNhdGVnb3J5TGlzdC54c2QiIGRlZmF1bHQ9IiIgbGFzdFNhdmVkU2Vzc2lvbj0iMSIgbGFzdFNhdmVkVGltZT0iMjAyNS0wOC0yN1QxNzoxNTozMC45Njc5MzFaIj4KICA8SXRlbUlkIElkPSJBUU1rQURNeE5HRTNOREJsTFdNNVlUZ3RORGN4TkMxaFkyTUFaUzAxT0RZek5ESTRNbU15Wm1JQVJnQUFBODZORVF5NW5reEtraSs3ZllrTlZQWUhBTzE5VHhSaXV2aFBnR0NzM1pJMUgzMEFBQUlCRFFBQUFPMTlUeFJpdXZoUGdHQ3MzWkkxSDMwQUFBSVIyQUFBQUE9PSIgQ2hhbmdlS2V5PSJDUUFBQUJZQUFBRHRmVThVWXJyNFQ0QmdyTjJTTlI5OUFBS1lWMjFoIj48L0l0ZW1JZD4KICA8Y2F0ZWdvcnkgbmFtZT0iUm90ZSBLYXRlZ29yaWUiIGNvbG9yPSIwIiBrZXlib2FyZFNob3J0Y3V0PSIwIiBsYXN0VGltZVVzZWROb3Rlcz0iMjAyMi0xMC0wM1QxNDozMToxMC44Mzk1NTYyWiIgbGFzdFRpbWVVc2VkSm91cm5hbD0iMjAyMi0xMC0wM1QxNDozMToxMC44Mzk1NTYyWiIgbGFzdFRpbWVVc2VkQ29udGFjdHM9IjIwMjItMTAtMDNUMTQ6MzE6MTAuODM5NTU2MloiIGxhc3RUaW1lVXNlZFRhc2tzPSIyMDIyLTEwLTAzVDE0OjMxOjEwLjgzOTU1NjJaIiBsYXN0VGltZVVzZWRDYWxlbmRhcj0iMjAyMi0xMC0wM1QxNDozMToxMC44Mzk1NTYyWiIgbGFzdFRpbWVVc2VkTWFpbD0iMjAyMi0xMC0wM1QxNDozMToxMC44Mzk1NTYyWiIgbGFzdFRpbWVVc2VkPSIyMDIyLTEwLTAzVDE0OjMxOjEwLjgzOTU1NjJaIiBsYXN0U2Vzc2lvblVzZWQ9IjAiIGd1aWQ9IntlY2ZiNzFiNC0yM2ViLTQ3Y2EtOGEwZi0yYWU0NjYwYjFhMDR9IiByZW5hbWVPbkZpcnN0VXNlPSIxIj48L2NhdGVnb3J5PgogIDxjYXRlZ29yeSBuYW1lPSJPcmFuZ2VmYXJiZW5lIEthdGVnb3JpZSIgY29sb3I9IjEiIGtleWJvYXJkU2hvcnRjdXQ9IjAiIGxhc3RUaW1lVXNlZE5vdGVzPSIyMDIyLTEwLTAzVDE0OjMxOjEwLjgzOTU1NjJaIiBsYXN0VGltZVVzZWRKb3VybmFsPSIyMDIyLTEwLTAzVDE0OjMxOjEwLjgzOTU1NjJaIiBsYXN0VGltZVVzZWRDb250YWN0cz0iMjAyMi0xMC0wM1QxNDozMToxMC44Mzk1NTYyWiIgbGFzdFRpbWVVc2VkVGFza3M9IjIwMjItMTAtMDNUMTQ6MzE6MTAuODM5NTU2MloiIGxhc3RUaW1lVXNlZENhbGVuZGFyPSIyMDIyLTEwLTAzVDE0OjMxOjEwLjgzOTU1NjJaIiBsYXN0VGltZVVzZWRNYWlsPSIyMDIyLTEwLTAzVDE0OjMxOjEwLjgzOTU1NjJaIiBsYXN0VGltZVVzZWQ9IjIwMjItMTAtMDNUMTQ6MzE6MTAuODM5NTU2MloiIGxhc3RTZXNzaW9uVXNlZD0iMCIgZ3VpZD0ie2ZmYTIwNjM1LWIzNmYtNGJjZC1iNDViLTBmZGYwOTQyZGQxY30iIHJlbmFtZU9uRmlyc3RVc2U9IjEiPjwvY2F0ZWdvcnk+CiAgPGNhdGVnb3J5IG5hbWU9IkdlbGJlIEthdGVnb3JpZSIgY29sb3I9IjMiIGtleWJvYXJkU2hvcnRjdXQ9IjAiIGxhc3RUaW1lVXNlZE5vdGVzPSIyMDIyLTEwLTAzVDE0OjMxOjEwLjgzOTU1NjJaIiBsYXN0VGltZVVzZWRKb3VybmFsPSIyMDIyLTEwLTAzVDE0OjMxOjEwLjgzOTU1NjJaIiBsYXN0VGltZVVzZWRDb250YWN0cz0iMjAyMi0xMC0wM1QxNDozMToxMC44Mzk1NTYyWiIgbGFzdFRpbWVVc2VkVGFza3M9IjIwMjItMTAtMDNUMTQ6MzE6MTAuODM5NTU2MloiIGxhc3RUaW1lVXNlZENhbGVuZGFyPSIyMDIyLTEwLTAzVDE0OjMxOjEwLjgzOTU1NjJaIiBsYXN0VGltZVVzZWRNYWlsPSIyMDIyLTEwLTAzVDE0OjMxOjEwLjgzOTU1NjJaIiBsYXN0VGltZVVzZWQ9IjIwMjItMTAtMDNUMTQ6MzE6MTAuODM5NTU2MloiIGxhc3RTZXNzaW9uVXNlZD0iMCIgZ3VpZD0iezg2YjhiODVjLTRkMzMtNGNjMC04ZDI1LWU5ZDlkNjJiYzNmMX0iIHJlbmFtZU9uRmlyc3RVc2U9IjEiPjwvY2F0ZWdvcnk+CiAgPGNhdGVnb3J5IG5hbWU9Ikdyw7xuZSBLYXRlZ29yaWUiIGNvbG9yPSI0IiBrZXlib2FyZFNob3J0Y3V0PSIwIiBsYXN0VGltZVVzZWROb3Rlcz0iMjAyMi0xMC0wM1QxNDozMToxMC44Mzk1NTYyWiIgbGFzdFRpbWVVc2VkSm91cm5hbD0iMjAyMi0xMC0wM1QxNDozMToxMC44Mzk1NTYyWiIgbGFzdFRpbWVVc2VkQ29udGFjdHM9IjIwMjItMTAtMDNUMTQ6MzE6MTAuODM5NTU2MloiIGxhc3RUaW1lVXNlZFRhc2tzPSIyMDIyLTEwLTAzVDE0OjMxOjEwLjgzOTU1NjJaIiBsYXN0VGltZVVzZWRDYWxlbmRhcj0iMjAyMi0xMC0wM1QxNDozMToxMC44Mzk1NTYyWiIgbGFzdFRpbWVVc2VkTWFpbD0iMjAyMi0xMC0wM1QxNDozMToxMC44Mzk1NTYyWiIgbGFzdFRpbWVVc2VkPSIyMDIyLTEwLTAzVDE0OjMxOjEwLjgzOTU1NjJaIiBsYXN0U2Vzc2lvblVzZWQ9IjAiIGd1aWQ9IntlZWY0MWM5Mi0xMDI1LTQ1MDMtYTVhYi0zNGQ1OGFmYWIyY2Z9IiByZW5hbWVPbkZpcnN0VXNlPSIxIj48L2NhdGVnb3J5PgogIDxjYXRlZ29yeSBuYW1lPSJCbGF1ZSBLYXRlZ29yaWUiIGNvbG9yPSI3IiBrZXlib2FyZFNob3J0Y3V0PSIwIiBsYXN0VGltZVVzZWROb3Rlcz0iMjAyMi0xMC0wM1QxNDozMToxMC44Mzk1NTYyWiIgbGFzdFRpbWVVc2VkSm91cm5hbD0iMjAyMi0xMC0wM1QxNDozMToxMC44Mzk1NTYyWiIgbGFzdFRpbWVVc2VkQ29udGFjdHM9IjIwMjItMTAtMDNUMTQ6MzE6MTAuODM5NTU2MloiIGxhc3RUaW1lVXNlZFRhc2tzPSIyMDIyLTEwLTAzVDE0OjMxOjEwLjgzOTU1NjJaIiBsYXN0VGltZVVzZWRDYWxlbmRhcj0iMjAyMi0xMC0wM1QxNDozMToxMC44Mzk1NTYyWiIgbGFzdFRpbWVVc2VkTWFpbD0iMjAyMi0xMC0wM1QxNDozMToxMC44Mzk1NTYyWiIgbGFzdFRpbWVVc2VkPSIyMDIyLTEwLTAzVDE0OjMxOjEwLjgzOTU1NjJaIiBsYXN0U2Vzc2lvblVzZWQ9IjAiIGd1aWQ9InszNTZhM2Q0Mi1hYWNjLTRiNWUtODE3My01MmZmMmU5NWIxYzR9IiByZW5hbWVPbkZpcnN0VXNlPSIxIj48L2NhdGVnb3J5PgogIDxjYXRlZ29yeSBuYW1lPSJMaWxhIEthdGVnb3JpZSIgY29sb3I9IjgiIGtleWJvYXJkU2hvcnRjdXQ9IjAiIGxhc3RUaW1lVXNlZE5vdGVzPSIyMDIyLTEwLTAzVDE0OjMxOjEwLjgzOTU1NjJaIiBsYXN0VGltZVVzZWRKb3VybmFsPSIyMDIyLTEwLTAzVDE0OjMxOjEwLjgzOTU1NjJaIiBsYXN0VGltZVVzZWRDb250YWN0cz0iMjAyMi0xMC0wM1QxNDozMToxMC44Mzk1NTYyWiIgbGFzdFRpbWVVc2VkVGFza3M9IjIwMjItMTAtMDNUMTQ6MzE6MTAuODM5NTU2MloiIGxhc3RUaW1lVXNlZENhbGVuZGFyPSIyMDIyLTEwLTAzVDE0OjMxOjEwLjgzOTU1NjJaIiBsYXN0VGltZVVzZWRNYWlsPSIyMDIyLTEwLTAzVDE0OjMxOjEwLjgzOTU1NjJaIiBsYXN0VGltZVVzZWQ9IjIwMjItMTAtMDNUMTQ6MzE6MTAuODM5NTU2MloiIGxhc3RTZXNzaW9uVXNlZD0iMCIgZ3VpZD0ie2MxYTRmNWQzLWIzYmYtNGU4NS1iZDlkLTZlMmEzNTBiN2I3MX0iIHJlbmFtZU9uRmlyc3RVc2U9IjEiPjwvY2F0ZWdvcnk+CiAgPGNhdGVnb3J5IG5hbWU9InRlc3QiIGNvbG9yPSIyNCIga2V5Ym9hcmRTaG9ydGN1dD0iMCIgbGFzdFRpbWVVc2VkTm90ZXM9IjIwMjUtMDgtMjZUMTQ6Mzc6NDQuNjcwMTA4N1oiIGxhc3RUaW1lVXNlZEpvdXJuYWw9IjIwMjUtMDgtMjZUMTQ6Mzc6NDQuNjcwMTA4N1oiIGxhc3RUaW1lVXNlZENvbnRhY3RzPSIyMDI1LTA4LTI2VDE0OjM3OjQ0LjY3MDEwODdaIiBsYXN0VGltZVVzZWRUYXNrcz0iMjAyNS0wOC0yNlQxNDozNzo0NC42NzAxMDg3WiIgbGFzdFRpbWVVc2VkQ2FsZW5kYXI9IjIwMjUtMDgtMjZUMTQ6Mzc6NDQuNjcwMTA4N1oiIGxhc3RUaW1lVXNlZE1haWw9IjIwMjUtMDgtMjZUMTQ6Mzc6NDQuNjcwMTA4N1oiIGxhc3RUaW1lVXNlZD0iMjAyNS0wOC0yNlQxNDozNzo0NC42NzAxMDg3WiIgbGFzdFNlc3Npb25Vc2VkPSIwIiBndWlkPSJ7YjM4YjM3NjgtMWE1MS00N2ZlLWJjNGMtZmQ5NzAwZDg4ODI3fSIgcmVuYW1lT25GaXJzdFVzZT0iMCI+PC9jYXRlZ29yeT4KICA8Y2F0ZWdvcnkgbmFtZT0idGhpc19jb21lc19mcm9tX2hvc2hpaSIgY29sb3I9IjgiIGtleWJvYXJkU2hvcnRjdXQ9IjAiIGxhc3RUaW1lVXNlZD0iMjAyNS0wOC0yN1QxNzoxNTozMC45Njc5MzFaIiBsYXN0U2Vzc2lvblVzZWQ9IjEiIGd1aWQ9InswZjU4ZTdhNS1jYzA2LTQwZWUtYjFlYy0xOTUwODI1Njk0NDZ9Ij48L2NhdGVnb3J5Pgo8L2NhdGVnb3JpZXM+</Value>
            </t:ExtendedProperty>
          </t:Message>
        </t:SetItemField>
      </t:Updates>
    </t:ItemChange>
  </m:ItemChanges>
</m:UpdateItem>
	`
	response, err := client.SendAndReceive([]byte(xmlData))
	if err != nil {
		t.Fatalf("Error sending and receiving: %v", err)
	}

	fmt.Println(string(response))
}
